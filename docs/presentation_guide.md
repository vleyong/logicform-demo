# Logicform 语义层架构汇报指南

这份指南旨在帮助您向领导或团队清晰地阐述本项目的核心价值。不仅演示代码，更要演示**设计思想**。

## 一、 核心痛点 (The "Why")

在汇报开场，建议先抛出当前 "ChatBI" 或 "Text-to-SQL" 面临的三个死穴：

1.  **幻觉 (Hallucination)**：LLM 可能会编造不存在的字段（如 `sales_amt` 编成 `revenue`），导致 SQL 报错。
2.  **口径不一 (Inconsistency)**：张三问“销售额”算的是 `SUM(amt)`，李四问“营收”算的是 `SUM(amt) - SUM(tax)`。LLM 每次生成的逻辑可能都不一样。
3.  **甚至不敢用 (Unsafe)**：直接让 LLM 写 SQL，万一它写了个全表扫描或者 `DELETE` 怎么办？

**一句话总结**：我们不能把**计算的准确性**寄托在**概率性**的 LLM 上。

## 二、 解决方案：Logicform 架构 (The "What")

我们引入了一个中间层 —— **Logicform (语义范式)**。

### 核心类比：点菜系统
*   **LLM 是服务员**：它负责听懂顾客（用户）千奇百怪的方言（自然语言），然后在点菜机上选好 **“菜品编号” (Logicform)**。它**不负责炒菜**。
*   **Compiler 是厨师**：看到“菜品编号”，严格按照 **SOP (Schema)** 炒菜（生成 SQL）。

### 价值主张
1.  **确定性**：无论用户怎么问，只要意图识别对（Logicform 对），生成的 SQL 就**绝对**是标准的。
2.  **安全性**：LLM 接触不到底层物理表，只能操作我们开放的指标。
3.  **可维护性**：指标口径变了（比如“达成率”公式变了），只需要改 `schema.py` 一处代码，不用去调教 LLM 的 Prompt。

## 三、 演示流程建议 (The Demo)

建议打开 `demo.py` 的运行结果，按以下步骤讲解：

### Step 1: 展示“听不懂”也能“做对” (Case 1)
*   **用户问**："Show me the total sales amount..."
*   **LLM 识别**：识别出用户想要 `sales_volume`（销售额）。
*   **系统执行**：展示生成的 SQL。
    *   **重点**：指着 SQL 里的 `SUM(sales.total_amt)` 说：“看，虽然用户没说 total_amt 这个物理字段，但系统自动映射对了。”

### Step 2: 展示“复杂指标”的封装 (Case 2)
*   **用户问**："What is the sales achievement rate..."（达成率）。
*   **系统执行**：生成的 SQL 里出现了一个复杂的除法公式。
    *   **重点**：打开 `logicform/schema.py`，展示 `achievement_rate` 的定义。
    *   **话术**：“领导你看，这个复杂的除法公式是我们在代码里写死的。LLM 根本不知道这个公式，它只是告诉我们要算‘达成率’。这就保证了全公司看的数据口径是 100% 一致的。”

### Step 3: 展示自动关联 (Auto-Join)
*   **重点**：指着 SQL 里的 `LEFT JOIN ...`。
*   **话术**：“LLM 没告诉我要怎么关联表，但因为我们要看‘店铺区域’，系统自动就能把‘销售表’和‘店铺表’连起来，这也是我们在代码里控制的，绝不会连错。”

## 四、 关键 QA 预演

**Q: 如果我有几千个指标怎么办？**
**A:** 这正是 Semantic Layer 的优势。我们可以在 `SchemaRegistry` 里管理几千个指标，LLM 只需要检索相关的几个即可（配合 RAG 技术），不需要把几千个指标都塞给 LLM。

**Q: 为什么要造这个轮子，不直接用 Text-to-SQL？**
**A:** 直接 Text-to-SQL 就像让实习生直接操作核心生产库，风险太大且不可控。Logicform 架构相当于给实习生配了一个资深审核员（Compiler），既利用了实习生的灵活性（自然语言理解），又保证了输出的专业性（标准 SQL）。
